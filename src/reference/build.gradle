buildscript {
  dependencies {
    classpath 'org.asciidoctor:asciidoctorj-epub3:1.5.0-alpha.7'
    classpath 'org.asciidoctor:asciidoctorj-pdf:1.5.0-alpha.15'
  }
}

plugins {
  id 'org.asciidoctor.convert' version '1.5.3'
}

repositories {
  maven { url 'https://repo.spring.io/libs-snapshot' }
  maven { url 'https://repo.spring.io/libs-milestone' }
  maven { url 'https://repo.spring.io/plugins-release' }
  mavenCentral()
}

apply plugin: 'org.asciidoctor.convert'

asciidoctorj {
  version = '1.5.5'
}

apply plugin: "org.asciidoctor.convert"
configurations {
	docs
}

dependencies {
	docs "io.spring.docresources:spring-doc-resources:0.1.0.RELEASE@zip"
}

task prepareAsciidocBuild(type: Sync) {
	dependsOn configurations.docs
	// copy doc resources
	from {
		configurations.docs.collect { zipTree(it) }
	}
	// and doc sources
	from 'asciidoc'
  exclude 'stylesheets'
	// to a build directory of your choice
	into '../../build/working'
}

asciidoctor {
  dependsOn 'prepareAsciidocBuild'
  sourceDir = file('../../build/working')
  outputDir = file('../../build/docs')
  sources {
		include 'index.adoc'
	}
	resources {
		from(sourceDir) {
			include 'images/*', 'css/*', 'js/**'
		}
	}
  logDocuments = true
  backends = ['html5', 'pdf']
  options doctype: 'book', eruby: 'erubis'
  attributes  'icons': 'font',
      'idprefix': '',
      'idseparator': '-',
      docinfo: 'shared',
      revnumber: project.version,
      sectanchors: '',
      sectnums: '',
      stylesdir: 'css/',
      stylesheet: 'spring.css',
      'linkcss': true,
      'source-highlighter=highlight.js',
      'highlightjsdir=js/highlight',
      'highlightjs-theme=atom-one-dark-reasonable',
      'spring-version': project.version,
      'allow-uri-read': ''

  separateOutputDirs = false
}
